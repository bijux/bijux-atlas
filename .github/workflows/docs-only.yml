name: docs-only

on:
  pull_request:
    paths:
      - 'docs/**'
      - 'mkdocs.yml'
      - 'makefiles/_docs.mk'
      - 'docs/contracts/**/*.json'
      - 'docs/_generated/openapi/**'
      - 'configs/openapi/v1/openapi.generated.json'

permissions:
  contents: read

jobs:
  docs-check:
    runs-on: ubuntu-latest
    env:
      ISO_ROOT: artifacts/isolates/docs-only
      CARGO_TARGET_DIR: artifacts/isolates/docs-only/target
      CARGO_HOME: artifacts/isolates/docs-only/cargo-home
      TMPDIR: artifacts/isolates/docs-only/tmp
      TMP: artifacts/isolates/docs-only/tmp
      TEMP: artifacts/isolates/docs-only/tmp
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: 1.84.1
      - run: make docs-doctor
      - run: |
          if command -v mkdocs >/dev/null 2>&1; then
            cargo run -p bijux-dev-atlas -- docs check --allow-subprocess --allow-write --format json
          else
            echo "mkdocs not installed; skipping docs build check"
          fi
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: docs-site-pr
          path: artifacts/dist/docs-site
