name: atlas-dev-rust

on:
  pull_request:
    paths:
      - 'Cargo.toml'
      - 'Cargo.lock'
      - 'crates/bijux-dev-atlas/**'
      - 'crates/bijux-dev-atlas-core/**'
      - 'crates/bijux-dev-atlas-model/**'
      - 'crates/bijux-dev-atlas-adapters/**'
      - 'crates/bijux-atlas-cli/**'
  push:
    branches: [main]
    paths:
      - 'Cargo.toml'
      - 'Cargo.lock'
      - 'crates/bijux-dev-atlas/**'
      - 'crates/bijux-dev-atlas-core/**'
      - 'crates/bijux-dev-atlas-model/**'
      - 'crates/bijux-dev-atlas-adapters/**'
      - 'crates/bijux-atlas-cli/**'

jobs:
  atlas-dev:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - name: Build atlas dev crates
        run: |
          cargo build -p bijux-dev-atlas-model -p bijux-dev-atlas-adapters -p bijux-dev-atlas-core -p bijux-dev-atlas
      - name: Test atlas dev crates
        run: |
          cargo test -p bijux-dev-atlas-model -p bijux-dev-atlas-adapters -p bijux-dev-atlas-core -p bijux-dev-atlas
      - name: Smoke help and version
        run: |
          cargo run -p bijux-dev-atlas -- --help >/dev/null
          cargo run -p bijux-dev-atlas -- --version >/dev/null
