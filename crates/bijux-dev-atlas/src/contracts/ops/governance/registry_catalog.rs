// SPDX-License-Identifier: Apache-2.0

pub fn contracts(repo_root: &Path) -> Result<Vec<Contract>, String> {
    let mut rows = root_surface_contracts();
    rows.extend(pillar_contracts());
    validate_registry(&rows, repo_root)?;
    Ok(rows)
}

pub fn contract_explain(contract_id: &str) -> &'static str {
    match contract_id {
        "OPS-ROOT-017" => "Defines the only allowed root ops filesystem surface and markdown envelope.",
        "OPS-ROOT-018" => "Governs generated artifact lifecycle boundaries under _generated and _generated.example.",
        "OPS-ROOT-019" => "Requires per-domain README/CONTRACT and forbids legacy duplicate docs.",
        "OPS-ROOT-020" => "Enforces markdown size budgets so contracts stay concise and reviewable.",
        "OPS-ROOT-021" => "Enforces SSOT boundary: ops README is navigation-only and points to docs/operations.",
        "OPS-ROOT-022" => "Ensures ops/CONTRACT.md is generated from and synchronized with registry metadata.",
        "OPS-ROOT-001" => "Constrains ops root surface to canonical control-plane files and domain directories.",
        "OPS-ROOT-002" => "Forbids extra markdown documents at ops root beyond README.md and CONTRACT.md.",
        "OPS-ROOT-003" => "Forbids shell script artifacts and bash shebangs in ops policy/config trees.",
        "OPS-ROOT-004" => "Enforces directory-depth budget for ops artifacts to avoid uncontrolled nesting.",
        "OPS-ROOT-005" => "Enforces stable filename policy with explicit allowlisted exceptions.",
        "OPS-ROOT-006" => "Requires gitignore policy for runtime-generated ops/_generated artifacts.",
        "OPS-ROOT-007" => "Guards committed generated examples against secret-like payload leakage.",
        "OPS-ROOT-008" => "Requires placeholder directories to be explicitly listed in inventory allowlist.",
        "OPS-ROOT-009" => "Requires ops policy/config artifacts to be covered by inventory mappings.",
        "OPS-ROOT-010" => "Prevents reintroduction of deleted legacy ops markdown policy documents.",
        "OPS-ROOT-023" => "Ensures operations docs policy statements reference executable OPS contract IDs.",
        "OPS-ROOT-SURFACE-001" => "Ensures required ops stack/k8s/load/observe/list commands exist in router surface.",
        "OPS-ROOT-SURFACE-002" => "Ensures listed command surface equals action dispatch surface with no hidden commands.",
        "OPS-ROOT-SURFACE-003" => "Ensures command surface list ordering is deterministic.",
        "OPS-ROOT-SURFACE-004" => "Ensures mapped commands include explicit effects_required declarations.",
        "OPS-ROOT-SURFACE-005" => "Ensures command actions are grouped only under approved pillar-style domains.",
        "OPS-ROOT-SURFACE-006" => "Forbids ad-hoc command group domains such as misc/util.",
        "OPS-ROOT-SURFACE-007" => "Ensures each command action declares a stable purpose string.",
        "OPS-ROOT-SURFACE-008" => "Ensures each command action declares json output support.",
        "OPS-ROOT-SURFACE-009" => "Ensures each command action declares dry-run policy metadata.",
        "OPS-ROOT-SURFACE-010" => "Ensures each command action declares artifacts root write policy.",
        "OPS-ROOT-011" => "Restricts ops markdown files to explicit allowlisted paths.",
        "OPS-ROOT-012" => "Ensures each non-root pillar has exactly one README.md at pillar root.",
        "OPS-ROOT-013" => "Ensures markdown allowlist inventory file exists and is non-empty.",
        "OPS-ROOT-014" => "Ensures procedure/policy language in ops markdown is linked to OPS contract IDs.",
        "OPS-ROOT-015" => "Enforces minimal pillar markdown surface via allowlist.",
        "OPS-ROOT-016" => "Prevents reintroduction of historically deleted markdown paths via denylist.",
        "OPS-INV-001" => "Ensures domain and policy registration completeness in inventory sources.",
        "OPS-INV-002" => "Prevents orphan ops files that are not mapped by inventory references.",
        "OPS-INV-003" => "Forbids duplicate SSOT markdown documents when inventory is authoritative.",
        "OPS-INV-004" => "Enforces authority-tier exception structure with explicit expiry metadata.",
        "OPS-INV-005" => "Validates inventory control-graph integrity, mappings, and cycle safety.",
        "OPS-INV-006" => "Validates contract id format consistency in the ops contract registry.",
        "OPS-INV-007" => "Ensures gates registry exists with one unique mapped action per gate id.",
        "OPS-INV-008" => "Ensures drills registry ids map to runnable observability drill definitions.",
        "OPS-INV-009" => "Ensures owners registry covers each canonical ops domain directory.",
        "OPS-INV-010" => "Ensures required inventory schema files exist under ops/schema/inventory.",
        "OPS-INV-MAP-001" => "Ensures every contract id is present in contract-gate-map mappings.",
        "OPS-INV-MAP-002" => "Ensures mapped gate ids resolve to declared entries in gates registry.",
        "OPS-INV-MAP-003" => "Ensures mapped commands exist in the ops command surface router snapshot.",
        "OPS-INV-MAP-004" => "Ensures effects annotations in map align with contract test kind modes.",
        "OPS-INV-MAP-005" => "Ensures no gate id is orphaned outside contract-gate-map references.",
        "OPS-INV-MAP-006" => "Ensures every contract maps to gates or is explicitly static-only.",
        "OPS-INV-MAP-007" => "Ensures static-only map entries refer only to pure test contracts.",
        "OPS-INV-MAP-008" => "Ensures effect mappings use effectful test kinds and explicit effect annotations.",
        "OPS-INV-MAP-009" => "Ensures explain mapping source includes gate ids for non-static contracts.",
        "OPS-INV-MAP-010" => "Ensures contract-gate-map is sorted by contract id and canonical json format.",
        "OPS-INV-PILLARS-001" => "Validates pillars SSOT exists and parses as inventory metadata.",
        "OPS-INV-PILLARS-002" => "Validates each declared pillar has a concrete directory under ops/.",
        "OPS-INV-PILLARS-003" => "Validates there are no undeclared pillar directories in ops root.",
        "OPS-INV-DEBT-001" => "Ensures contract debt registry exists with an owner and target milestone for each deferred item.",
        "OPS-SCHEMA-001" => "Ensures ops json/yaml policy documents are parseable.",
        "OPS-SCHEMA-002" => "Ensures generated schema index matches on-disk schema sources.",
        "OPS-SCHEMA-003" => "Enforces stable .schema.json naming for schema source files.",
        "OPS-SCHEMA-004" => "Enforces per-domain schema count budgets to limit sprawl.",
        "OPS-SCHEMA-005" => "Requires compatibility lock coverage for schema evolution governance.",
        "OPS-SCHEMA-006" => "Ensures schema files declare stable $id values aligned with file names.",
        "OPS-SCHEMA-007" => "Ensures schema examples cover required fields declared in compatibility lock.",
        "OPS-SCHEMA-008" => "Prevents duplicate schema $id or title intent across schema sources.",
        "OPS-SCHEMA-009" => "Enforces canonical pretty JSON formatting for generated schema artifacts.",
        "OPS-SCHEMA-010" => "Ensures each compatibility-lock schema target declares an existing example fixture.",
        "OPS-DATASETS-001" => "Ensures datasets manifest and lock use the same dataset id set.",
        "OPS-DATASETS-002" => "Ensures fixture inventory maps cleanly to fixture directories and references.",
        "OPS-DATASETS-003" => "Requires fixture drift to be covered by explicit promotion policy metadata.",
        "OPS-DATASETS-004" => "Ensures release-diff fixture assets and goldens stay deterministic and pinned.",
        "OPS-DATASETS-005" => "Ensures dataset qc metadata references a parseable qc summary golden.",
        "OPS-DATASETS-006" => "Ensures rollback policy exists and provides required rollback structure.",
        "OPS-DATASETS-007" => "Ensures promotion rules declare canonical environments and required pin sources.",
        "OPS-DATASETS-008" => "Ensures dataset consumer interfaces point at existing runnable repository artifacts.",
        "OPS-DATASETS-009" => "Ensures dataset freeze policy enforces append-only and non-replacement immutability.",
        "OPS-DATASETS-010" => "Ensures dataset ids and fixture paths follow canonical store layout conventions.",
        "OPS-E2E-001" => "Ensures e2e suites map to concrete scenario ids and runnable scripts.",
        "OPS-E2E-002" => "Ensures smoke manifest structure and lock references are valid.",
        "OPS-E2E-003" => "Ensures fixture lock digest and allowlist file policy remain consistent.",
        "OPS-E2E-004" => "Ensures realdata snapshots are parseable and pinned to canonical queries.",
        "OPS-E2E-005" => "Ensures taxonomy categories classify each declared e2e scenario.",
        "OPS-E2E-006" => "Ensures reproducibility policy and deterministic e2e summary ordering are enforced.",
        "OPS-E2E-007" => "Ensures coverage matrix rows and coverage sets are deterministic and complete.",
        "OPS-E2E-008" => "Ensures realdata scenarios and snapshots are structurally valid and runnable.",
        "OPS-E2E-009" => "Ensures e2e directory surface is restricted to declared artifacts only.",
        "OPS-E2E-010" => "Ensures e2e summary is schema-valid and aligned with suite/scenario registries.",
        "OPS-E2E-E-001" => "Effect lane contract for smoke suite declaration in e2e registry.",
        "OPS-E2E-E-002" => "Effect lane contract for realdata scenario declaration in e2e registry.",
        "OPS-ENV-001" => "Ensures required environment overlays satisfy structural schema rules.",
        "OPS-ENV-002" => "Ensures base/ci/dev/prod overlay coverage and profile identity consistency.",
        "OPS-ENV-003" => "Enforces strict known-key policy for environment overlay payloads.",
        "OPS-ENV-004" => "Ensures overlay merge behavior is deterministic for identical profile inputs.",
        "OPS-ENV-005" => "Ensures prod overlay forbids dev-only effect toggles and unrestricted network mode.",
        "OPS-ENV-006" => "Ensures ci overlay keeps subprocess effects disabled and restricted networking.",
        "OPS-ENV-007" => "Ensures base overlay defines required default keys consumed across environments.",
        "OPS-ENV-008" => "Ensures overlay values keys remain stable and schema-versioned across profiles.",
        "OPS-ENV-009" => "Ensures overlays directory has no stray files and portability matrix exists.",
        "OPS-K8S-001" => "Ensures helm chart sources expose static render prerequisites.",
        "OPS-K8S-002" => "Ensures install-matrix values files exist and parse against chart schema surface.",
        "OPS-K8S-003" => "Ensures install-matrix covers canonical k8s profile set and file references.",
        "OPS-K8S-004" => "Forbids disallowed cluster-scope object kinds in helm templates.",
        "OPS-K8S-005" => "Forbids cluster-admin and wildcard RBAC grants in k8s chart templates.",
        "OPS-K8S-006" => "Ensures deployment template includes pod security hardening and probes.",
        "OPS-K8S-007" => "Ensures rollout safety contract fields are valid and rollout chart enforces steps.",
        "OPS-K8S-008" => "Ensures conformance suite declarations exist and are wired into ops command surface.",
        "OPS-K8S-009" => "Ensures install matrix aligns with generated k8s release and render indexes.",
        "OPS-K8S-010" => "Ensures generated k8s indexes are schema-versioned and deterministically ordered.",
        "OPS-K8S-E-001" => "Effect lane contract for helm install profile coverage in k8s matrix.",
        "OPS-K8S-E-002" => "Effect lane contract for rollout safety checks declaration.",
        "OPS-K8S-E-003" => "Effect lane contract for service endpoint reachability suite coverage.",
        "OPS-LOAD-001" => "Ensures load scenarios are parseable and keep required fields.",
        "OPS-LOAD-002" => "Ensures each load suite has a matching thresholds artifact.",
        "OPS-LOAD-003" => "Ensures pinned query lock digests match source query payload.",
        "OPS-LOAD-004" => "Ensures load baselines are parseable and include required structure.",
        "OPS-LOAD-005" => "Ensures smoke/pr load suites are covered by inventory SLO mappings.",
        "OPS-LOAD-006" => "Ensures load drift report artifact exists and includes schema envelope fields.",
        "OPS-LOAD-007" => "Ensures load result schema and generated sample summary stay structurally aligned.",
        "OPS-LOAD-008" => "Ensures cheap-only-survival suite is retained in minimal confidence gate lanes.",
        "OPS-LOAD-009" => "Ensures cold-start-p99 suite is retained in required confidence gate lanes.",
        "OPS-LOAD-010" => "Ensures each declared load suite maps to scenario SLO impact coverage.",
        "OPS-LOAD-E-001" => "Effect lane contract for executable k6 load suite coverage.",
        "OPS-LOAD-E-002" => "Effect lane contract for threshold enforcement and load summary emission.",
        "OPS-LOAD-E-003" => "Effect lane contract for emitted load baseline drift comparison.",
        "OPS-OBS-001" => "Ensures observability alert rules exist and are parseable.",
        "OPS-OBS-002" => "Ensures observability dashboard json aligns with committed golden identity.",
        "OPS-OBS-003" => "Ensures telemetry goldens for required profiles exist and are indexed.",
        "OPS-OBS-004" => "Ensures readiness contract is parseable and contains canonical requirements.",
        "OPS-OBS-005" => "Ensures alert catalog is populated and aligned with parsed alert rule sources.",
        "OPS-OBS-006" => "Ensures SLO definitions and burn-rate alert rules remain semantically aligned.",
        "OPS-OBS-007" => "Ensures public observability surface coverage rules include required surfaces.",
        "OPS-OBS-008" => "Ensures telemetry index artifacts remain schema-versioned and deterministic.",
        "OPS-OBS-009" => "Ensures observability drills manifest includes runnable drill definitions.",
        "OPS-OBS-010" => "Ensures overload behavior contract exists and is mapped to load-suite enforcement coverage.",
        "OPS-OBS-E-001" => "Effect lane contract for metrics scrape evidence input.",
        "OPS-OBS-E-002" => "Effect lane contract for trace structure evidence input.",
        "OPS-OBS-E-003" => "Effect lane contract for alert rule loading inputs.",
        "OPS-REPORT-001" => "Ensures report schema is the SSOT and mirrored under ops/schema/report.",
        "OPS-REPORT-002" => "Ensures generated report payloads are parseable and include schema_version.",
        "OPS-REPORT-003" => "Ensures report evidence levels include minimal standard and forensic tiers.",
        "OPS-REPORT-004" => "Ensures generated report diff includes base target and change structure.",
        "OPS-REPORT-005" => "Ensures readiness score report is deterministic and keyed by canonical input sources.",
        "OPS-REPORT-006" => "Ensures release evidence bundle is parseable and references existing report artifacts.",
        "OPS-REPORT-007" => "Ensures historical comparison report includes required trend and readiness signals.",
        "OPS-REPORT-008" => "Ensures unified report example contains required schema, lane, summary, and budget sections.",
        "OPS-REPORT-009" => "Ensures report outputs use canonical pretty JSON formatting and deterministic key ordering.",
        "OPS-REPORT-010" => "Ensures unified report summary is an aggregate of emitted per-lane statuses.",
        "OPS-STACK-001" => "Ensures stack.toml parses and defines canonical execution profiles.",
        "OPS-STACK-002" => "Ensures service dependency contract entries are structurally valid.",
        "OPS-STACK-003" => "Ensures stack version manifest is parseable and digest pinned.",
        "OPS-STACK-004" => "Ensures stack dependency graph references real assets and consistent profile links.",
        "OPS-STACK-005" => "Ensures dev/perf/small kind profile coverage and required cluster config fields.",
        "OPS-STACK-006" => "Ensures stack ports inventory endpoint mapping is unique and component-aware.",
        "OPS-STACK-007" => "Ensures stack health report evidence carries schema envelope and generator provenance.",
        "OPS-STACK-008" => "Ensures stack up/down verbs remain present in control-plane command surface snapshot.",
        "OPS-STACK-009" => "Ensures offline or airgap claims are backed by explicit stack profile entries.",
        "OPS-STACK-E-001" => "Effect lane contract for kind dev cluster bring-up inputs.",
        "OPS-STACK-E-002" => "Effect lane contract for core stack component rollout manifests.",
        "OPS-STACK-E-003" => "Effect lane contract for stack ports inventory mapping evidence.",
        "OPS-STACK-E-004" => "Effect lane contract for stack health report evidence.",
        _ => "No explanation registered for this contract id.",
    }
}
