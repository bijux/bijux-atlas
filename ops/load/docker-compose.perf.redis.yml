services:
  redis:
    image: redis:7-alpine
    ports:
      - "16379:6379"

  atlas-server:
    build:
      context: ..
      dockerfile: Dockerfile
    image: bijux-atlas:perf-redis-local
    depends_on:
      - redis
    environment:
      ATLAS_BIND: 0.0.0.0:8080
      ATLAS_STORE_ROOT: /srv/store
      ATLAS_CACHE_ROOT: /srv/cache
      ATLAS_READINESS_REQUIRES_CATALOG: "false"
      ATLAS_STARTUP_WARMUP: 110/homo_sapiens/GRCh38
      ATLAS_STARTUP_WARMUP_LIMIT: "1"
      ATLAS_MAX_CONCURRENT_DOWNLOADS: "3"
      ATLAS_REDIS_URL: redis://redis:6379/
      ATLAS_REDIS_PREFIX: atlas
      ATLAS_ENABLE_REDIS_RESPONSE_CACHE: "true"
      ATLAS_ENABLE_REDIS_RATE_LIMIT: "true"
    volumes:
      - ../artifacts/perf/store:/srv/store:ro
      - ../artifacts/perf/cache:/srv/cache
    ports:
      - "18081:8080"
