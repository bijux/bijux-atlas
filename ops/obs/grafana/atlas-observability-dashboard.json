{
  "title": "Bijux Atlas Observability",
  "uid": "bijux-atlas-observability-v1",
  "schemaVersion": 39,
  "version": 2,
  "timezone": "utc",
  "panels": [
    {"title": "Failure Domain: Store", "type": "row"},
    {
      "title": "Store Backend Fetch p95",
      "description": "Is store dependency latency elevated by backend?",
      "type": "timeseries",
      "targets": [{"expr": "bijux_store_fetch_latency_p95_seconds"}]
    },
    {
      "title": "Store Open/Download p95",
      "description": "Is open or download latency the dominant store bottleneck?",
      "type": "timeseries",
      "targets": [
        {"expr": "bijux_store_open_p95_seconds"},
        {"expr": "bijux_store_download_p95_seconds"}
      ]
    },

    {"title": "Failure Domain: Cache", "type": "row"},
    {
      "title": "Dataset Cache Hit/Miss",
      "description": "Is cache behavior shifting from hit-dominant to miss-heavy?",
      "type": "timeseries",
      "targets": [
        {"expr": "rate(bijux_dataset_hits[5m])"},
        {"expr": "rate(bijux_dataset_misses[5m])"}
      ]
    },
    {
      "title": "Cache Hit Ratio",
      "description": "Is cache hit ratio dropping below expected baseline?",
      "type": "timeseries",
      "targets": [
        {"expr": "rate(bijux_dataset_hits[5m]) / clamp_min(rate(bijux_dataset_hits[5m]) + rate(bijux_dataset_misses[5m]), 1e-9)"}
      ]
    },
    {
      "title": "Dataset Cache Size",
      "description": "Is cache footprint within expected dataset and byte budget?",
      "type": "stat",
      "targets": [
        {"expr": "bijux_dataset_count"},
        {"expr": "bijux_dataset_disk_usage_bytes"}
      ]
    },

    {"title": "Failure Domain: SQLite", "type": "row"},
    {
      "title": "SQLite Query p95 by Class",
      "description": "Which query class is driving sqlite latency regression?",
      "type": "timeseries",
      "targets": [{"expr": "bijux_sqlite_query_latency_p95_seconds"}]
    },

    {"title": "Failure Domain: Admission/Bulkhead", "type": "row"},
    {
      "title": "Shed Rate by Reason",
      "description": "Which shed reason dominates during degradation events?",
      "type": "timeseries",
      "targets": [{"expr": "sum by (reason) (rate(atlas_shed_total[5m]))"}]
    },
    {
      "title": "Bulkhead Inflight by Class",
      "description": "Are class bulkheads receiving expected load distribution?",
      "type": "timeseries",
      "targets": [{"expr": "atlas_bulkhead_inflight"}]
    },
    {
      "title": "Bulkhead Saturation by Class",
      "description": "Are any class bulkheads saturating near 1.0 persistently?",
      "type": "timeseries",
      "targets": [{"expr": "atlas_bulkhead_saturation"}]
    },
    {
      "title": "Queue Depth and Overload",
      "description": "Is overload state aligned with queue pressure growth?",
      "type": "timeseries",
      "targets": [
        {"expr": "bijux_request_queue_depth"},
        {"expr": "atlas_overload_active"}
      ]
    },

    {"title": "Failure Domain: K8s Resource Pressure", "type": "row"},
    {
      "title": "Disk IO and FS Pressure",
      "description": "Is node-level storage pressure causing cache or request instability?",
      "type": "timeseries",
      "targets": [
        {"expr": "bijux_disk_io_latency_p95_ns"},
        {"expr": "bijux_fs_space_pressure_events_total"}
      ]
    },

    {"title": "Traffic and SLO", "type": "row"},
    {
      "title": "HTTP Request Rate by Route/Status",
      "description": "Which route/status pair drives request volume changes?",
      "type": "timeseries",
      "targets": [{"expr": "sum by (route,status) (rate(bijux_http_requests_total[5m]))"}]
    },
    {
      "title": "HTTP p95 Latency by Route",
      "description": "Which route template is violating p95 latency expectations?",
      "type": "timeseries",
      "targets": [{"expr": "bijux_http_request_latency_p95_seconds"}]
    },
    {
      "title": "Endpoint Request/Response Size p95",
      "description": "Are payload sizes trending toward configured guardrails?",
      "type": "timeseries",
      "targets": [
        {"expr": "bijux_http_request_size_p95_bytes"},
        {"expr": "bijux_http_response_size_p95_bytes"}
      ]
    },
    {
      "title": "SLO Burn Rate (5xx, 5m/1h)",
      "description": "Is current error budget burn above SLO acceptance threshold?",
      "type": "timeseries",
      "targets": [
        {"expr": "(sum(rate(bijux_http_requests_total{status=~\"5..\"}[5m])) / sum(rate(bijux_http_requests_total[5m]))) / 0.005"},
        {"expr": "(sum(rate(bijux_http_requests_total{status=~\"5..\"}[1h])) / sum(rate(bijux_http_requests_total[1h]))) / 0.005"}
      ]
    },

    {"title": "Drill Views", "type": "row"},
    {
      "title": "Traffic Spike Drill View",
      "description": "During spike drills, do cheap routes survive while heavy paths shed?",
      "type": "timeseries",
      "targets": [
        {"expr": "sum(rate(atlas_shed_total[5m]))"},
        {"expr": "atlas_overload_active"},
        {"expr": "bijux_http_request_latency_p95_seconds{route=\"/v1/genes\"}"}
      ]
    },
    {
      "title": "Rollout/Rollback View",
      "description": "Do rollout/rollback windows preserve request success and latency?",
      "type": "timeseries",
      "targets": [
        {"expr": "sum(rate(bijux_http_requests_total{status=~\"2..\"}[5m]))"},
        {"expr": "sum(rate(bijux_http_requests_total{status=~\"5..\"}[5m]))"},
        {"expr": "bijux_http_request_latency_p95_seconds"}
      ]
    },
    {
      "title": "p99 Breakdown via Exemplars",
      "description": "Can exemplar request ids explain p99 outliers across query phases?",
      "type": "timeseries",
      "targets": [
        {"expr": "bijux_http_request_latency_p95_seconds"},
        {"expr": "bijux_request_stage_latency_p95_seconds"}
      ]
    }
  ],
  "tags": [
    "contract_git_sha:REQUIRED_AT_BUILD"
  ]
}
