{
  "$defs": {
    "endpoint_class_budget": {
      "additionalProperties": false,
      "properties": {
        "max_limit": {
          "minimum": 1,
          "type": "integer"
        },
        "max_prefix_cost_units": {
          "minimum": 1,
          "type": "integer"
        },
        "max_region_estimated_rows": {
          "minimum": 1,
          "type": "integer"
        },
        "max_region_span": {
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "max_limit",
        "max_region_span",
        "max_region_estimated_rows",
        "max_prefix_cost_units"
      ],
      "type": "object"
    }
  },
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "properties": {
    "allow_override": {
      "type": "boolean"
    },
    "cache_budget": {
      "additionalProperties": false,
      "properties": {
        "max_dataset_count": {
          "minimum": 1,
          "type": "integer"
        },
        "max_disk_bytes": {
          "minimum": 1,
          "type": "integer"
        },
        "max_open_shards_per_pod": {
          "minimum": 1,
          "type": "integer"
        },
        "pinned_datasets_max": {
          "minimum": 0,
          "type": "integer"
        },
        "shard_count_policy_max": {
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "max_disk_bytes",
        "max_dataset_count",
        "pinned_datasets_max",
        "shard_count_policy_max",
        "max_open_shards_per_pod"
      ],
      "type": "object"
    },
    "concurrency_bulkheads": {
      "additionalProperties": false,
      "properties": {
        "cheap": {
          "minimum": 1,
          "type": "integer"
        },
        "heavy": {
          "minimum": 1,
          "type": "integer"
        },
        "medium": {
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "cheap",
        "medium",
        "heavy"
      ],
      "type": "object"
    },
    "documented_defaults": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "field": {
            "minLength": 1,
            "type": "string"
          },
          "reason": {
            "minLength": 1,
            "type": "string"
          }
        },
        "required": [
          "field",
          "reason"
        ],
        "type": "object"
      },
      "type": "array"
    },
    "network_in_unit_tests": {
      "type": "boolean"
    },
    "publish_gates": {
      "additionalProperties": false,
      "properties": {
        "max_missing_parents": {
          "minimum": 0,
          "type": "integer"
        },
        "min_gene_count": {
          "minimum": 1,
          "type": "integer"
        },
        "required_indexes": {
          "items": {
            "minLength": 1,
            "type": "string"
          },
          "minItems": 1,
          "type": "array"
        }
      },
      "required": [
        "required_indexes",
        "min_gene_count",
        "max_missing_parents"
      ],
      "type": "object"
    },
    "query_budget": {
      "additionalProperties": false,
      "properties": {
        "cheap": {
          "$ref": "#/$defs/endpoint_class_budget"
        },
        "heavy": {
          "$ref": "#/$defs/endpoint_class_budget"
        },
        "heavy_projection_limit": {
          "minimum": 1,
          "type": "integer"
        },
        "max_limit": {
          "minimum": 1,
          "type": "integer"
        },
        "max_prefix_length": {
          "minimum": 1,
          "type": "integer"
        },
        "max_sequence_bases": {
          "minimum": 1,
          "type": "integer"
        },
        "max_transcript_limit": {
          "minimum": 1,
          "type": "integer"
        },
        "medium": {
          "$ref": "#/$defs/endpoint_class_budget"
        },
        "sequence_api_key_required_bases": {
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "cheap",
        "medium",
        "heavy",
        "max_limit",
        "max_transcript_limit",
        "heavy_projection_limit",
        "max_prefix_length",
        "max_sequence_bases",
        "sequence_api_key_required_bases"
      ],
      "type": "object"
    },
    "rate_limit": {
      "additionalProperties": false,
      "properties": {
        "per_api_key_rps": {
          "minimum": 1,
          "type": "integer"
        },
        "per_ip_rps": {
          "minimum": 1,
          "type": "integer"
        },
        "sequence_per_ip_rps": {
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "per_ip_rps",
        "per_api_key_rps",
        "sequence_per_ip_rps"
      ],
      "type": "object"
    },
    "response_budget": {
      "additionalProperties": false,
      "properties": {
        "cheap_max_bytes": {
          "minimum": 1,
          "type": "integer"
        },
        "heavy_max_bytes": {
          "minimum": 1,
          "type": "integer"
        },
        "max_serialization_bytes": {
          "minimum": 1,
          "type": "integer"
        },
        "medium_max_bytes": {
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "cheap_max_bytes",
        "medium_max_bytes",
        "heavy_max_bytes",
        "max_serialization_bytes"
      ],
      "type": "object"
    },
    "schema_version": {
      "const": "1",
      "type": "string"
    },
    "store_resilience": {
      "additionalProperties": false,
      "properties": {
        "breaker_failure_threshold": {
          "minimum": 1,
          "type": "integer"
        },
        "breaker_open_ms": {
          "minimum": 1,
          "type": "integer"
        },
        "retry_attempts": {
          "minimum": 1,
          "type": "integer"
        },
        "retry_base_backoff_ms": {
          "minimum": 1,
          "type": "integer"
        },
        "retry_budget": {
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "retry_budget",
        "retry_attempts",
        "retry_base_backoff_ms",
        "breaker_failure_threshold",
        "breaker_open_ms"
      ],
      "type": "object"
    },
    "telemetry": {
      "additionalProperties": false,
      "properties": {
        "metrics_enabled": {
          "type": "boolean"
        },
        "request_id_required": {
          "type": "boolean"
        },
        "required_metric_labels": {
          "items": {
            "minLength": 1,
            "type": "string"
          },
          "minItems": 1,
          "type": "array"
        },
        "slow_query_log_enabled": {
          "type": "boolean"
        },
        "trace_sampling_per_10k": {
          "maximum": 10000,
          "minimum": 1,
          "type": "integer"
        },
        "tracing_enabled": {
          "type": "boolean"
        }
      },
      "required": [
        "metrics_enabled",
        "tracing_enabled",
        "slow_query_log_enabled",
        "request_id_required",
        "required_metric_labels",
        "trace_sampling_per_10k"
      ],
      "type": "object"
    }
  },
  "required": [
    "schema_version",
    "allow_override",
    "network_in_unit_tests",
    "query_budget",
    "response_budget",
    "cache_budget",
    "store_resilience",
    "rate_limit",
    "concurrency_bulkheads",
    "telemetry",
    "publish_gates",
    "documented_defaults"
  ],
  "title": "Atlas Policy Config",
  "type": "object"
}
